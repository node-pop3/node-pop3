{"version":3,"file":"Command.cjs","names":["_Connection","_interopRequireDefault","require","_helper","e","__esModule","default","Pop3Command","Pop3Connection","constructor","user","password","host","port","tls","timeout","tlsOptions","servername","_PASSInfo","_connect","_socket","connect","command","info","UIDL","msgNumber","stream","listify","str","stream2String","NOOP","LIST","RSET","RETR","DELE","STAT","LAST","TOP","numLines","QUIT","_default","exports","module"],"sources":["../src/Command.js"],"sourcesContent":["import Pop3Connection from './Connection.js';\r\n\r\nimport {stream2String, listify} from './helper.js';\r\n\r\n/**\r\n * @typedef {number} Integer\r\n */\r\n\r\n/**\r\n *\r\n */\r\nclass Pop3Command extends Pop3Connection {\r\n  /**\r\n   * @param {{\r\n   *   user: string,\r\n   *   password: string,\r\n   *   host: string,\r\n   *   port?: Integer,\r\n   *   tls?: boolean,\r\n   *   timeout?: Integer,\r\n   *   tlsOptions?: import('tls').TlsOptions,\r\n   *   servername?: string\r\n   * }} cfg\r\n   */\r\n  constructor ({\r\n    user,\r\n    password,\r\n    host,\r\n    port,\r\n    tls,\r\n    timeout,\r\n    tlsOptions,\r\n    servername\r\n  }) {\r\n    super({host, port, tls, timeout, tlsOptions, servername});\r\n    this.user = user;\r\n    this.password = password;\r\n    this._PASSInfo = '';\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<string>}\r\n   */\r\n  async _connect () {\r\n    if (this._socket) {\r\n      return this._PASSInfo;\r\n    }\r\n    await super.connect();\r\n    await super.command('USER', this.user);\r\n    const [info] = await super.command('PASS', this.password);\r\n    this._PASSInfo = info;\r\n    return this._PASSInfo;\r\n  }\r\n\r\n  /**\r\n   * @param {Integer|string} msgNumber\r\n   * @returns {Promise<string[][]|string[]>}\r\n   */\r\n  async UIDL (msgNumber = '') {\r\n    await this._connect();\r\n    const [info, stream] = await super.command('UIDL', msgNumber);\r\n    if (msgNumber) {\r\n      return listify(info)[0];\r\n    }\r\n    const str = await stream2String(stream);\r\n    return listify(str);\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<void>}\r\n   */\r\n  async NOOP () {\r\n    await this._connect();\r\n    await super.command('NOOP');\r\n  }\r\n\r\n  /**\r\n   * @param {Integer|string} msgNumber\r\n   * @returns {Promise<string[][]|string[]>}\r\n   */\r\n  async LIST (msgNumber = '') {\r\n    await this._connect();\r\n    const [info, stream] = await super.command('LIST', msgNumber);\r\n    if (msgNumber) {\r\n      return listify(info)[0];\r\n    }\r\n    const str = await stream2String(stream);\r\n    return listify(str);\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<string>}\r\n   */\r\n  async RSET () {\r\n    await this._connect();\r\n    const [info] = await super.command('RSET');\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * @param {Integer} msgNumber\r\n   * @returns {Promise<string>}\r\n   */\r\n  async RETR (msgNumber) {\r\n    await this._connect();\r\n    const [, stream] = await super.command('RETR', msgNumber);\r\n    return stream2String(stream);\r\n  }\r\n\r\n  /**\r\n   * @param {Integer} msgNumber\r\n   * @returns {Promise<string>}\r\n   */\r\n  async DELE (msgNumber) {\r\n    await this._connect();\r\n    const [info] = await super.command('DELE', msgNumber);\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<string>}\r\n   */\r\n  async STAT () {\r\n    await this._connect();\r\n    const [info] = await super.command('STAT');\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<string>}\r\n   */\r\n  async LAST () {\r\n    await this._connect();\r\n    const [info] = await super.command('LAST');\r\n    /* c8 ignore next 2 */\r\n    // May fail depending on test server\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * @param {Integer} msgNumber\r\n   * @param {Integer} numLines\r\n   * @returns {Promise<string>}\r\n   */\r\n  async TOP (msgNumber, numLines = 0) {\r\n    await this._connect();\r\n    const [, stream] = await super.command('TOP', msgNumber, numLines);\r\n    return stream2String(stream);\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<string>}\r\n   */\r\n  async QUIT () {\r\n    if (!this._socket) {\r\n      this._PASSInfo = 'Bye';\r\n      return this._PASSInfo;\r\n    }\r\n    const [info] = await super.command('QUIT');\r\n    this._PASSInfo = info || '';\r\n    return this._PASSInfo;\r\n  }\r\n}\r\n\r\nPop3Command.stream2String = stream2String;\r\nPop3Command.listify = listify;\r\n\r\nexport default Pop3Command;\r\n"],"mappings":"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","ignoreList":[]}