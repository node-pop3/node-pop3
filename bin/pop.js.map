{"version":3,"sources":["index.mjs"],"names":[],"mappings":"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","file":"pop.js","sourcesContent":["#!/usr/bin/env node\nimport {resolve as pathResolve} from 'path';\nimport Pop3Command from '../lib/Command';\n\nimport {stream2String} from '../lib/helper';\n\nconst {argv} = process,\n  options = {},\n  alias = {\n    c: 'config',\n    u: 'user',\n    p: 'password',\n    h: 'host',\n    m: 'method',\n  },\n  requiredOptionNames = ['user', 'password', 'host', 'method'],\n  mailStructure = {\n    port: 110,\n    tls: false,\n  },\n  mailStructureOptionNames = ['user', 'password', 'host', 'port', 'tls', 'timeout'];\n\nfunction printHelpAndExit() {\n  const text = 'Usage: pop [options]\\r\\n'\n           + '\\r\\n'\n           + 'Example: pop -u example@gmail.com -p pwd -h example.pop3.com -m UIDL\\r\\n'\n           + '\\r\\n'\n           + 'Options:\\r\\n'\n           + '  -c, --config      config file (in place of options below)\\r\\n'\n           + '  -u, --user        username\\r\\n'\n           + '  -p, --password    password\\r\\n'\n           + '  -h, --host        host of server\\r\\n'\n           + '  --port            port of server. Defaults to 110 or 995 if tls is used.\\r\\n'\n           + '  --tls             whether to use TLS(SSL). Defaults to false.\\r\\n'\n           + '  --no-tls          disables previously set TLS(SSL).\\r\\n'\n           + '  -m, --method      method and arguments of API in node-pop3. e.g. \\'UIDL\\', \\'RETR 100\\' or \\'command USER example@gmail.com\\'\\r\\n'\n           + '  --help            print help';\n  console.log(text);\n  process.exit(0);\n}\n\nlet optionName;\nif (argv.slice(2).some(function(arg, i, args) {\n  if (arg.charAt(0) === '-') {\n    optionName = arg.replace(/^-+/g, '');\n    if ((optionName || '').length === 1) {\n      if (!{}.hasOwnProperty.call(alias, optionName)) {\n        console.error('Invalid alias', optionName);\n        return true;\n      }\n      optionName = alias[optionName];\n    }\n    if (\n      optionName &&\n      (i === args.length - 1 || args[i + 1].charAt(0) === '-')\n    ) {\n      options[optionName] = [true];\n    }\n  } else if (!optionName) {\n    console.error('Invalid argument', arg);\n    return true;\n  } else if (options[optionName]) {\n    options[optionName].push(arg);\n  } else {\n    options[optionName] = [arg];\n  }\n})) {\n  process.exit();\n}\n\nif (options.help) {\n  printHelpAndExit();\n}\n\nif (options.config) {\n  const configOptions = require(pathResolve(process.cwd(), options.config[0]));\n  ['method', ...mailStructureOptionNames].forEach((optionName) => {\n    if (!(optionName in options) && optionName in configOptions) {\n      options[optionName] = [configOptions[optionName]];\n    }\n  });\n}\n\nfor (const requiredOptionName of requiredOptionNames) {\n  if (!options[requiredOptionName]) {\n    console.error(requiredOptionName + ' is required!');\n    printHelpAndExit();\n  }\n}\n\nif (options.timeout) {\n  options.timeout[0] = parseFloat(options.timeout[0]);\n}\n\nif ('no-tls' in options) {\n  options.tls = [false];\n} else if (options.tls && options.tls[0]) {\n  // By using `mailStructure`, can still be overridden below\n  mailStructure.port = '995';\n}\nfor (const _optionName of mailStructureOptionNames) {\n  mailStructure[_optionName] = (\n    options[_optionName] || []\n  )[0] || mailStructure[_optionName];\n}\n\nconst pop3Command = new Pop3Command(mailStructure);\nconst [methodName] = options.method;\n\n// Todo: Might want to report this to Istnabul as nyc doesn't seem to pick\n//   this up, despite it running\n// istanbul ignore next\n(async () => {\n\nlet result;\ntry {\n  if (['UIDL', 'TOP', 'QUIT', 'RETR'].includes(methodName)) {\n    result = await pop3Command[methodName](...options.method.slice(1));\n  } else {\n    await pop3Command._connect();\n    result = await pop3Command.command(...options.method);\n    if (result[1]) {\n      const [info, stream] = result;\n      const str = await stream2String(stream);\n      result = [info, str];\n    }\n  }\n  if (methodName !== 'QUIT') {\n    await pop3Command.QUIT();\n  }\n} catch (err) {\n  console.error(err);\n  process.exit();\n}\n\nconsole.dir(result);\nprocess.exit(0);\n\n})();\n"]}