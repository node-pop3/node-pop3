{"version":3,"file":"pop.js","names":["value","then","direct","Promise","resolve","body","result","recover","e","f","args","i","arguments","length","apply","reject","process","argv","options","alias","c","u","p","h","m","requiredOptionNames","mailStructure","port","tls","mailStructureOptionNames","printHelpAndExit","text","console","log","exit","optionName","slice","some","arg","charAt","replace","hasOwnProperty","call","error","push","help","config","configOptions","require","pathResolve","cwd","forEach","requiredOptionName","timeout","parseFloat","_optionName","pop3Command","Pop3Command","method","methodName","includes","_connect","command","info","stream","stream2String","str","QUIT","err","dir"],"sources":["index.mjs"],"sourcesContent":["#!/usr/bin/env node\r\nimport {resolve as pathResolve} from 'path';\r\nimport Pop3Command from '../lib/Command';\r\n\r\nimport {stream2String} from '../lib/helper';\r\n\r\nconst {argv} = process,\r\n  options = {},\r\n  alias = {\r\n    c: 'config',\r\n    u: 'user',\r\n    p: 'password',\r\n    h: 'host',\r\n    m: 'method',\r\n  },\r\n  requiredOptionNames = ['user', 'password', 'host', 'method'],\r\n  mailStructure = {\r\n    port: 110,\r\n    tls: false,\r\n  },\r\n  mailStructureOptionNames = ['user', 'password', 'host', 'port', 'tls', 'timeout'];\r\n\r\nfunction printHelpAndExit() {\r\n  const text = 'Usage: pop [options]\\r\\n'\r\n           + '\\r\\n'\r\n           + 'Example: pop -u example@gmail.com -p pwd -h example.pop3.com -m UIDL\\r\\n'\r\n           + '\\r\\n'\r\n           + 'Options:\\r\\n'\r\n           + '  -c, --config      config file (in place of options below)\\r\\n'\r\n           + '  -u, --user        username\\r\\n'\r\n           + '  -p, --password    password\\r\\n'\r\n           + '  -h, --host        host of server\\r\\n'\r\n           + '  --port            port of server. Defaults to 110 or 995 if tls is used.\\r\\n'\r\n           + '  --tls             whether to use TLS(SSL). Defaults to false.\\r\\n'\r\n           + '  --no-tls          disables previously set TLS(SSL).\\r\\n'\r\n           + '  -m, --method      method and arguments of API in node-pop3. e.g. \\'UIDL\\', \\'RETR 100\\' or \\'command USER example@gmail.com\\'\\r\\n'\r\n           + '  --help            print help';\r\n  console.log(text);\r\n  process.exit(0);\r\n}\r\n\r\nlet optionName;\r\nif (argv.slice(2).some(function(arg, i, args) {\r\n  if (arg.charAt(0) === '-') {\r\n    optionName = arg.replace(/^-+/g, '');\r\n    if ((optionName || '').length === 1) {\r\n      if (!{}.hasOwnProperty.call(alias, optionName)) {\r\n        console.error('Invalid alias', optionName);\r\n        return true;\r\n      }\r\n      optionName = alias[optionName];\r\n    }\r\n    if (\r\n      optionName &&\r\n      (i === args.length - 1 || args[i + 1].charAt(0) === '-')\r\n    ) {\r\n      options[optionName] = [true];\r\n    }\r\n  } else if (!optionName) {\r\n    console.error('Invalid argument', arg);\r\n    return true;\r\n  } else if (options[optionName]) {\r\n    options[optionName].push(arg);\r\n  } else {\r\n    options[optionName] = [arg];\r\n  }\r\n})) {\r\n  process.exit();\r\n}\r\n\r\nif (options.help) {\r\n  printHelpAndExit();\r\n}\r\n\r\nif (options.config) {\r\n  const configOptions = require(pathResolve(process.cwd(), options.config[0]));\r\n  ['method', ...mailStructureOptionNames].forEach((optionName) => {\r\n    if (!(optionName in options) && optionName in configOptions) {\r\n      options[optionName] = [configOptions[optionName]];\r\n    }\r\n  });\r\n}\r\n\r\nfor (const requiredOptionName of requiredOptionNames) {\r\n  if (!options[requiredOptionName]) {\r\n    console.error(requiredOptionName + ' is required!');\r\n    printHelpAndExit();\r\n  }\r\n}\r\n\r\nif (options.timeout) {\r\n  options.timeout[0] = parseFloat(options.timeout[0]);\r\n}\r\n\r\nif ('no-tls' in options) {\r\n  options.tls = [false];\r\n} else if (options.tls && options.tls[0]) {\r\n  // By using `mailStructure`, can still be overridden below\r\n  mailStructure.port = '995';\r\n}\r\nfor (const _optionName of mailStructureOptionNames) {\r\n  mailStructure[_optionName] = (\r\n    options[_optionName] || []\r\n  )[0] || mailStructure[_optionName];\r\n}\r\n\r\nconst pop3Command = new Pop3Command(mailStructure);\r\nconst [methodName] = options.method;\r\n\r\n// Todo: Might want to report this to Istnabul as nyc doesn't seem to pick\r\n//   this up, despite it running\r\n// istanbul ignore next\r\n(async () => {\r\n\r\nlet result;\r\ntry {\r\n  if (['UIDL', 'TOP', 'QUIT', 'RETR'].includes(methodName)) {\r\n    result = await pop3Command[methodName](...options.method.slice(1));\r\n  } else {\r\n    await pop3Command._connect();\r\n    result = await pop3Command.command(...options.method);\r\n    if (result[1]) {\r\n      const [info, stream] = result;\r\n      const str = await stream2String(stream);\r\n      result = [info, str];\r\n    }\r\n  }\r\n  if (methodName !== 'QUIT') {\r\n    await pop3Command.QUIT();\r\n  }\r\n} catch (err) {\r\n  console.error(err);\r\n  process.exit();\r\n}\r\n\r\nconsole.dir(result);\r\nprocess.exit(0);\r\n\r\n})();\r\n"],"mappings":"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"}