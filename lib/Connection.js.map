{"version":3,"file":"Connection.js","names":["_net","require","_tls2","_interopRequireDefault","_events","_stream","_constant","obj","__esModule","_await","value","then","direct","Promise","resolve","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","err","isArray","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","arg","_toPrimitive","_typeof","String","input","hint","prim","toPrimitive","undefined","res","Number","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","Pop3Connection","_EventEmitter","_super","_ref","_this","host","port","tls","timeout","maxMailSize","tlsOptions","servername","_socket","_command","_updateStream","Readable","read","_pushStream","buffer","TERMINATOR_BUFFER_ARRAY","some","_buffer","equals","_endStream","endBuffer","TERMINATOR_BUFFER","emit","connect","_this2","socket","Socket","setKeepAlive","reject","setTimeout","Error","eventName","listeners","end","options","assign","_tls","on","command","firstLineEndIndex","indexOf","CRLF_BUFFER","infoBuffer","_split","split","_split2","commandName","stream","MULTI_LINE_COMMAND_NAME","includes","bodyBuffer","once","_this3","_len","args","_key","join","rejectFn","info","removeListener","write","concat","CRLF","EventEmitter","_default","exports","module","default"],"sources":["../src/Connection.mjs"],"sourcesContent":["import { Socket } from 'net';\nimport _tls from 'tls';\nimport { EventEmitter } from 'events';\nimport { Readable } from 'stream';\n\nimport {\n  CRLF,\n  CRLF_BUFFER,\n  TERMINATOR_BUFFER,\n  TERMINATOR_BUFFER_ARRAY,\n  MULTI_LINE_COMMAND_NAME\n} from './constant.mjs';\n\nclass Pop3Connection extends EventEmitter {\n  constructor({\n    host,\n    port,\n    tls,\n    timeout,\n    maxMailSize,\n    tlsOptions,\n    servername\n  }) {\n    super();\n    this.host = host;\n    this.port = port || (tls ? 995 : 110);\n    this.tls = tls;\n    this.timeout = timeout;\n    this.maxMailSize = maxMailSize;\n    this._socket = null;\n    this._stream = null;\n    this._command;\n    this.tlsOptions = tlsOptions || {};\n    this.servername = servername || host;\n  }\n\n  _updateStream() {\n    this._stream = new Readable({\n      read: () => {},\n    });\n    return this._stream;\n  }\n\n  _pushStream(buffer) {\n    if (TERMINATOR_BUFFER_ARRAY.some((_buffer) => _buffer.equals(buffer))) {\n      return this._endStream();\n    }\n    const endBuffer = buffer.slice(-5);\n    if (endBuffer.equals(TERMINATOR_BUFFER)) {\n      this._stream.push(buffer.slice(0, -5));\n      return this._endStream();\n    }\n    this._stream.push(buffer);\n  }\n\n  _endStream(err) {\n    if (this._stream) {\n      this._stream.push(null);\n    }\n    this._stream = null;\n    this.emit('end', err);\n  }\n\n  connect() {\n    const { host, port, tlsOptions, servername } = this;\n    const socket = new Socket();\n    socket.setKeepAlive(true);\n    return new Promise((resolve, reject) => {\n      if (typeof this.timeout !== 'undefined') {\n        socket.setTimeout(this.timeout, () => {\n          const err = new Error('timeout');\n          err.eventName = 'timeout';\n          reject(err);\n          if (this.listeners('end').length) {\n            this.emit('end', err);\n          }\n          if (this.listeners('error').length) {\n            this.emit('error', err);\n          }\n          this._socket.end();\n          this._socket = null;\n        });\n      }\n      if (this.tls) {\n        const options = Object.assign({ host, port, socket, servername }, tlsOptions);\n        this._socket = _tls.connect(options);\n      } else {\n        this._socket = socket;\n      }\n\n      this._socket.on('data', (buffer) => {\n        if (this._stream) {\n          return this._pushStream(buffer);\n        }\n        if (buffer[0] === 45) { // '-'\n          const err = new Error(buffer.slice(5, -2));\n          err.eventName = 'error';\n          err.command = this._command;\n          return this.emit('error', err);\n        }\n        if (buffer[0] === 43) { // '+'\n          const firstLineEndIndex = buffer.indexOf(CRLF_BUFFER);\n          const infoBuffer = buffer.slice(4, firstLineEndIndex);\n          const [commandName] = (this._command || '').split(' ');\n          let stream = null;\n          if (MULTI_LINE_COMMAND_NAME.includes(commandName)) {\n            this._updateStream();\n            stream = this._stream;\n            const bodyBuffer = buffer.slice(firstLineEndIndex + 2);\n            if (bodyBuffer[0]) {\n              this._pushStream(bodyBuffer);\n            }\n          }\n          this.emit('response', infoBuffer.toString(), stream);\n          resolve();\n          return;\n        }\n        const err = new Error('Unexpected response');\n        err.eventName = 'bad-server-response';\n        reject(err);\n      });\n      this._socket.on('error', (err) => {\n        err.eventName = 'error';\n        if (this._stream) {\n          this.emit('error', err);\n          return;\n        }\n        reject(err);\n        this._socket = null;\n      });\n      this._socket.once('close', () => {\n        const err = new Error('close');\n        err.eventName = 'close';\n        reject(err);\n        this._socket = null;\n      });\n      this._socket.once('end', () => {\n        const err = new Error('end');\n        err.eventName = 'end';\n        reject(err);\n        this._socket = null;\n      });\n      socket.connect({\n        host,\n        port,\n      });\n    });\n  }\n\n  async command(...args) {\n    this._command = args.join(' ');\n    if (!this._socket) {\n      throw new Error('no-socket');\n    }\n    await new Promise((resolve, reject) => {\n      if (!this._stream) {\n        return resolve();\n      }\n      this.once('error', (err) => {\n        return reject(err);\n      });\n      this.once('end', (err) => {\n        return err ? reject(err) : resolve();\n      });\n    });\n    return new Promise((resolve, reject) => {\n      const rejectFn = (err) => reject(err);\n      this.once('error', rejectFn);\n      this.once('response', (info, stream) => {\n        this.removeListener('error', rejectFn);\n        resolve([info, stream]);\n      });\n      if (!this._socket) {\n        reject(new Error('no-socket'));\n      }\n      this._socket.write(`${this._command}${CRLF}`, 'utf8');\n    });\n  }\n}\n\nexport default Pop3Connection;\n"],"mappings":"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"}